(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[831],{2071:function(e,t,n){"use strict";n.r(t),n.d(t,"favoritesDataSourceKey",function(){return y});var a=n(0),i=n(111),r=n(445),o=n(213),s=n(329),c=n(541),d=n(583),l=n(3441),u=n(3359),f=n(4),p=!f.e.isActivated("56292713-A4F8-4CA3-A7D3-094AE99609E4","09/26/2023"),m=p?3:2,_=function(){function e(e,t){var n=t.pageContext,i=t.dataRequestorType,r=void 0===i?function(e){function i(a){return e.call(this,a,{pageContext:n,tokenProvider:t.tokenProvider})||this}return Object(a.__extends)(i,e),i}(s.t):i,o=e.dataSourceName,d=void 0===o?"FavoritesDataSource":o;this._cache=new c.e({id:d},{pageContext:n}),this._version=m,this._cacheKey="".concat(d,"_").concat(n.aadUserId,"_v").concat(this._version),this._dataRequestor=new r({qosName:d}),this._pageContext=t.pageContext,this._getOneDriveDataSource=t.getOneDriveDataSource}return e.prototype.getFavoritedItems=function(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t,n,i,r;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return t=e.cachingStrategy,n=e.ignoreDirtyCache,i=Object(l.e)(),u.e&&t===d.e.onlyCache&&n&&i?[2,void 0]:[4,this._getDataUtilizingCache(e)];case 1:if(r=a.sent(),u.e&&t===d.e.bypassCache&&i&&Object(l.t)(),!r&&t===d.e.onlyCache)return[2,void 0];if(!r)throw new Error("Response not in expected format: ".concat(r));return[2,r]}})})},e.prototype.removeItemsFromCache=function(e){var t=e.itemIds;return Object(a.__awaiter)(this,void 0,void 0,function(){var e,n,i,r,o,s,c;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._getDataUtilizingCache({cachingStrategy:d.e.onlyCache,cacheTimeoutTime:0})];case 1:if(e=a.sent()){for(n=new Set,i=0,r=t;i<r.length;i++)o=r[i],n.add(o);s=!1,c=e.filter(function(e){var t=n.has(e.file.Id);return t&&(s=!0),!t}),s&&this._cache.updateCache(this.favoritedItemsCacheRequestKey,c)}return[3,3];case 2:return a.sent(),[3,3];case 3:return[2]}})})},e.prototype._getDataUtilizingCache=function(e){var t=this,n=e.cachingStrategy,i=e.cacheTimeoutTime,o=Object(a.__rest)(e,["cachingStrategy","cacheTimeoutTime"]);return this._cache.getDataUtilizingCache({cachingStrategy:Object(r.e)()?d.e.onlyCache:n,cacheRequestKey:this.favoritedItemsCacheRequestKey,cacheTimeoutTime:i,returnStatistics:!1,getData:function(){return t._getData(o)}})},e.prototype._getData=function(e){var t;return Object(a.__awaiter)(this,void 0,i.n,function(){var n,i,r,c,d,l,u,f,m,_,h,b,g,v;return Object(a.__generator)(this,function(y){switch(y.label){case 0:return n=e.top,i=void 0===n?500:n,r=e.skipToken,c=e.nucleus,l=(d=void 0===c?{}:c).skipRedirection,u=void 0!==l&&l,f=d.noForwarding,m=void 0!==f&&f,[4,this._getWebAbsoluteUrl()];case 1:return _=y.sent(),h=new o.t({webAbsoluteUrl:_}),b=h.build().segment("sp.FavoriteItemCollection.GetFavoriteItems").parameters(Object(a.__assign)({top:i},r?{skipToken:r}:{})).toString(),p?[2,this._dataRequestor.getData({url:b,webAbsoluteUrl:_,qosName:"getFavoritedItems",method:"GET",additionalHeaders:Object(a.__assign)(Object(a.__assign)({Caller:"ODBWeb"},u&&{nucleusRedirection:"false"}),m&&{noForwarding:"true"}),noRedirect:!0,parseResponse:function(e,t){var n,a=s.t.parseJSON(e),i=null===(n=null==a?void 0:a.d)||void 0===n?void 0:n.GetFavoriteItems;if(!i)throw new Error("Response not in expected format: ".concat(a));return JSON.parse(i)},telemetryHandler:function(e){return Object(a.__assign)(Object(a.__assign)({},e),{eventData:Object(a.__assign)(Object(a.__assign)({},e.eventData),{extraData:Object(a.__assign)(Object(a.__assign)({},e.eventData.extraData),{itemCount:e.response?e.response.length:-1})})})}})]:[4,this._dataRequestor.getData({url:b,webAbsoluteUrl:_,qosName:"getFavoritedItems",method:"GET",additionalHeaders:Object(a.__assign)(Object(a.__assign)({Caller:"ODBWeb"},u&&{nucleusRedirection:"false"}),m&&{noForwarding:"true"}),noRedirect:!0})];case 2:if(g=y.sent(),!(v=null===(t=null==g?void 0:g.d)||void 0===t?void 0:t.GetFavoriteItems))throw new Error("Response not in expected format: ".concat(g));return[2,JSON.parse(v)]}})})},Object.defineProperty(e.prototype,"favoritedItemsCacheRequestKey",{get:function(){return"".concat(this._cacheKey,"_getFavoritedItems")},enumerable:!1,configurable:!0}),e.prototype._getWebAbsoluteUrl=function(){return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(e){switch(e.label){case 0:return f.e.isActivated("F120C72D-938F-4B14-B9E8-A7A186C31268","08/21/2023","Use performant endpoints")?[4,this._getOneDriveDataSource()]:[2,this._pageContext.webAbsoluteUrl];case 1:return[4,e.sent().getPersonalUrl()];case 2:return[2,e.sent()]}})})},e}(),h=n(53),b=n(980),g=n(45),v=n(1400),y=Object(h.r)("FavoritesDataSource.key",_,{pageContext:g.e,getOneDriveDataSource:b.e.async.lazy,tokenProvider:v.e})},3215:function(e,t,n){"use strict";n.d(t,"e",function(){return r}),n.d(t,"t",function(){return o});var a=n(1),i=n(525),r=new a.e("followed"),o=new i.e("followedItem")},3359:function(e,t,n){"use strict";n.d(t,"e",function(){return a});var a=!n(4).e.isActivated("412301EB-A806-49EF-837F-4164D0D5DB49","03/27/2023","Resolve fav signal from cache")},3441:function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"n",function(){return r}),n.d(t,"t",function(){return o});var a="FAVORITES_CACHE_DIRTY";function i(){try{return!!localStorage.getItem(a)}catch(e){}return!1}function r(){try{localStorage.setItem(a,"true")}catch(e){}}function o(){try{localStorage.removeItem(a)}catch(e){}}},4408:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(8),i=n(1562);function r(e,t){var n,r=t.itemKey,o=t.isMountPoint,s=e.demandItemFacet(a.b,r);if(e.demandItemFacet(a.S,null==s?void 0:s.itemKey))return!0;var c=null===(n=e.demandItemFacet(a.m,r))||void 0===n?void 0:n.extension;return Object(i.e)({extension:c,isMountPoint:o,isList:!1})}},5024:function(e,t,n){"use strict";n.d(t,"t",function(){return c}),n.d(t,"e",function(){return d});var a=n(0),i=n(15),r=n(23),o=n(993),s=n(1504),c=Object(i.n)()(function(e){return l}),d=Object(i.n)()(function(e){return l});function l(e){return Object(a.__awaiter)(this,void 0,void 0,function(){var t;return Object(a.__generator)(this,function(n){switch(n.label){case 0:return t=s.e.serialize({}),[4,e(Object(o.e)(function(e){return e.demandItemFacet(r.e,t)}))];case 1:return n.sent(),[2]}})})}},5025:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(0),i=n(8);function r(e,t,n){var r;e.resolveItems({items:(r={},r[t]=Object(a.__assign)({},i.S.pack(n)),r)})}},5369:function(e,t,n){"use strict";n.d(t,"e",function(){return d});var a=n(1444),i=n(703),r=n(268),o=n(50),s=n(1015),c=n(5025);function d(e,t){var n,d,l,u=t.isFavorited,f=t.id,p=t.spItem,m=void 0===p?{}:p,_=t.driveItem,h=void 0===_?{}:_,b=t.sharesItemKey,g=s.e.serialize({id:f});Object(c.e)(e,g,u);var v=h.webAbsoluteUrl,y=h.itemId,S=h.driveId;if(v&&S&&y){var D=new o.e(v).authority,I="".concat(D,"/_api/v2.0"),x=a.e.serialize({driveItem:{endpoint:I,driveId:S,itemId:y}});e.mapKeys({mappings:(n={},n[x]=g,n)})}b&&e.mapKeys({mappings:(d={},d[b]=g,d)});var C=m.itemUrl;if(C){var O=Object(r.e)(C),w=i.e.serialize({spItemFullUrl:{itemFullUrl:O}});e.mapKeys({mappings:(l={},l[w]=g,l)})}return g}},6453:function(e,t,n){"use strict";n.r(t),n.d(t,"spFavoritesAddon",function(){return x});var a=n(15),i=n(250),r=n(8),o=n(134),s=n(246),c=n(5024),d=n(703),l=n(0),u=n(19),f=n(868),p=n(3215),m=n(23),_=n(4408),h=n(4),b=n(3),g=n(44),v=n(267),y=n(1504),S=!h.e.isActivated("F01DE29D-B569-499E-83F8-AF66263E0852","03/24/2023","Do not show favorite command until data resolves");function D(e,t){var n=t.itemKeys,a=y.e.serialize({}),i=!!e.demandItemFacet(m.e,a);if(S&&!i)return{isAvailable:!1};if(!n.every(function(t){var n=!!e.demandItemFacet(b.st,t);return Object(_.e)(e,{itemKey:t,isMountPoint:n})}))return{isAvailable:!1};var r=n[0],o=e.demandItemFacet(g.e,r),s=o&&v.e.serialize(o),c=e.demandItemFacet(b.Qe,s);return{isAvailable:!!(null==c?void 0:c.isDocumentLibrary)}}var I=Object(a.t)(function(){return function(e){e(Object(u.t)(g.e,f.e)(D)),e(Object(i.t)(d.t,p.e)(Object(a.a)(function(){return Object(l.__awaiter)(void 0,void 0,void 0,function(){return Object(l.__generator)(this,function(e){switch(e.label){case 0:return[4,n.ee([427],7229)];case 1:return[2,e.sent().spItemFollowItemOperationHandler]}})})})))}}),x=Object(a.t)(function(){return function(e){e(Object(o.t)({keyFacet:d.t,facets:[r.S]})),e(Object(i.t)(d.t,s.e)(c.t)),e(I)}})},7677:function(e,t,n){"use strict";n.r(t),n.d(t,"substrateFavoritesAddon",function(){return C});var a=n(15),i=n(250),r=n(8),o=n(23),s=n(42),c=n(134),d=n(246),l=n(0),u=n(39),f=n(86),p=n(583),m=n(3359),_=n(70),h=n(1015),b=n(1722),g=n(5369),v=n(5025),y=n(1079),S=Object(a.i)()(function e(t){var n=this,a=t.itemKey;return function(t){return Object(l.__awaiter)(n,void 0,void 0,function(){var n,i,r,c,d,S,D,I,x,C,O;return Object(l.__generator)(this,function(w){switch(w.label){case 0:if(n=t(Object(f.e)({isFavoritesEnabled:u.E,favoritesProvider:b.e})),i=n.isFavoritesEnabled,r=n.favoritesProvider,!(null==i?void 0:i()))return[2];if(!(null==r?void 0:r.getFavoritedItems))throw new _.e({code:"NoEdgeworthProvider"});if(c=new Set,d=!1,!m.e)return[3,4];w.label=1;case 1:return w.trys.push([1,3,,4]),[4,r.getFavoritedItems({cachingStrategy:p.e.onlyCache,cacheTimeoutTime:0,ignoreDirtyCache:!0})];case 2:return(S=w.sent())&&(D=new s.e({publisher:e}),S.forEach(function(e){var t,n,a=Object(g.e)(D,{isFavorited:!0,id:e.file.Id,spItem:{itemUrl:Object(y.e)(e)},driveItem:{webAbsoluteUrl:e.file.SharePointItem.SitePath,driveId:null===(t=e.file.OneDriveInfo)||void 0===t?void 0:t.DriveId,itemId:null===(n=e.file.OneDriveInfo)||void 0===n?void 0:n.ItemId}});c.add(a)}),D.resolveItems({items:(C={},C[a]=Object(l.__assign)({},o.e.pack({itemKeys:Array.from(c)})),C)}),t(D.execute())),[3,4];case 3:return w.sent(),d=!0,[3,4];case 4:I=new s.e({publisher:e}),x=[],w.label=5;case 5:return w.trys.push([5,7,,8]),[4,r.getFavoritedItems({cachingStrategy:p.e.bypassCache,cacheTimeoutTime:0})];case 6:return(w.sent()||[]).forEach(function(e){var t,n,a=h.e.serialize({id:e.file.Id});x.push(a),c.has(a)?c.delete(a):(d=!0,Object(g.e)(I,{isFavorited:!0,id:e.file.Id,spItem:{itemUrl:Object(y.e)(e)},driveItem:{webAbsoluteUrl:e.file.SharePointItem.SitePath,driveId:null===(t=e.file.OneDriveInfo)||void 0===t?void 0:t.DriveId,itemId:null===(n=e.file.OneDriveInfo)||void 0===n?void 0:n.ItemId}}))}),c.size>0&&(d=!0,c.forEach(function(e){Object(v.e)(I,e,void 0)})),[3,8];case 7:return w.sent(),d=!0,[3,8];case 8:return d&&I.resolveItems({items:(O={},O[a]=Object(l.__assign)({},o.e.pack({itemKeys:x})),O)}),t(I.execute()),[2]}})})}}),D=n(993),I=n(407),x=Object(a.n)()(function(e){var t=this;return function(e){return Object(l.__awaiter)(t,void 0,void 0,function(){var t;return Object(l.__generator)(this,function(n){switch(n.label){case 0:return t=I.e.serialize({}),[4,e(Object(D.e)(function(e){return e.demandItemFacet(o.e,t)}))];case 1:return n.sent(),[2]}})})}}),C=Object(a.t)(function(){return function(e){e(new s.e({publisher:C}).execute()),e(Object(c.t)({keyFacet:h.e,facets:[r.S]})),e(Object(i.t)(h.e,d.e)(x)),e(Object(c.t)({keyFacet:I.e,facets:[o.e]})),e(Object(i.t)(I.e,d.e)(S))}})}}]);